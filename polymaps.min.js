if(!org)var org={};if(!org.polymaps)org.polymaps={};
(function(q){function Q(){for(var e=0;e<Q.maps.length;e++)Q.maps[e].resize()}function U(e){return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}function V(e){return 180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360))}function Z(e,f){if(e.row>f.row){var a=e;e=f;f=a}return{x0:e.column,y0:e.row,x1:f.column,y1:f.row,dx:f.column-e.column,dy:f.row-e.row}}function ca(e,f,a,h,i){a=Math.max(a,Math.floor(f.y0));h=Math.min(h,Math.ceil(f.y1));if(e.x0==f.x0&&e.y0==f.y0?e.x0+f.dy/e.dy*e.dx<f.x1:e.x1-f.dy/
e.dy*e.dx<f.x0){var c=e;e=f;f=c}c=e.dx/e.dy;var d=f.dx/f.dy,l=e.dx>0,o=f.dx<0;for(a=a;a<h;a++){var t=c*Math.max(0,Math.min(e.dy,a+l-e.y0))+e.x0;i(Math.floor(d*Math.max(0,Math.min(f.dy,a+o-f.y0))+f.x0),Math.ceil(t),a)}}function da(e,f,a,h,i,c){var d=Z(e,f);f=Z(f,a);e=Z(a,e);if(d.dy>f.dy){a=d;d=f;f=a}if(d.dy>e.dy){a=d;d=e;e=a}if(f.dy>e.dy){a=f;f=e;e=a}d.dy&&ca(e,d,h,i,c);f.dy&&ca(e,f,h,i,c)}q.version="2.1+2.1+1";var Y={x:0,y:0};q.id=function(){var e=0;return function(){return++e}}();q.svg=function(e){return document.createElementNS(q.ns.svg,
e)};q.ns={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};q.transform=function(e,f,a,h,i,c){var d={},l,o,t;if(!arguments.length){e=1;f=i=a=0;h=1;c=0}d.zoomFraction=function(m){if(!arguments.length)return o;o=m;l=Math.floor(o+Math.log(Math.sqrt(e*e+f*f+a*a+h*h))/Math.log(2));t=Math.pow(2,-l);return d};d.apply=function(m){var j=Math.pow(2,-m.zoom),s=Math.pow(2,m.zoom-l);return{column:(e*m.column*j+a*m.row*j+i)*s,row:(f*m.column*j+h*m.row*j+c)*s,zoom:m.zoom-l}};d.unapply=function(m){var j=
Math.pow(2,-m.zoom),s=Math.pow(2,m.zoom+l);return{column:(m.column*j*h-m.row*j*a-i*h+c*a)/(e*h-f*a)*s,row:(m.column*j*f-m.row*j*e-i*f+c*e)/(a*f-h*e)*s,zoom:m.zoom+l}};d.toString=function(){return"matrix("+[e*t,f*t,a*t,h*t].join(" ")+" 0 0)"};return d.zoomFraction(0)};q.cache=function(e,f){function a(j){m--;f&&f(j);delete d[j.key];if(j.next)j.next.prev=j.prev;else if(o=j.prev)o.next=null;if(j.prev)j.prev.next=j.next;else if(l=j.next)l.prev=null}function h(){for(var j=o;m>t;j=j.prev){if(!j)break;j.lock||
a(j)}}var i={},c={},d={},l=null,o=null,t=64,m=0;i.peek=function(j){return d[[j.zoom,j.column,j.row].join("/")]};i.load=function(j,s){var z=[j.zoom,j.column,j.row].join("/"),x=d[z];if(x){if(x.prev){if(x.prev.next=x.next)x.next.prev=x.prev;else o=x.prev;x.prev=null;x.next=l;l=l.prev=x}x.lock=1;return c[z]=x}x={key:z,column:j.column,row:j.row,zoom:j.zoom,next:l,prev:null,lock:1};e.call(null,x,s);c[z]=d[z]=x;if(l)l.prev=x;else o=x;l=x;m++;return x};i.unload=function(j){if(!(j in c))return false;var s=
c[j];s.lock=0;delete c[j];s.request&&s.request.abort(false)&&a(s);return s};i.locks=function(){return c};i.size=function(j){if(!arguments.length)return t;t=j;h();return i};i.flush=function(){h();return i};i.clear=function(){for(var j in d){var s=d[j];s.request&&s.request.abort(false);f&&f(d[j]);if(s.lock){s.lock=0;s.element.parentNode.removeChild(s.element)}}c={};d={};l=o=null;m=0;return i};return i};q.url=function(e){function f(h){var i=h.zoom<0?1:1<<h.zoom,c=h.column%i;if(c<0)c+=i;return e.replace(/{(.)}/g,
function(d,l){switch(l){case "S":return a[(Math.abs(h.zoom)+h.row+c)%a.length];case "Z":return h.zoom;case "X":return c;case "Y":return h.row;case "B":var o=q.map.coordinateLocation({row:h.row,column:c,zoom:h.zoom}),t=q.map.coordinateLocation({row:h.row+1,column:c+1,zoom:h.zoom}),m=Math.ceil(Math.log(h.zoom)/Math.LN2);return t.lat.toFixed(m)+","+o.lon.toFixed(m)+","+o.lat.toFixed(m)+","+t.lon.toFixed(m)}return l})}var a=[];f.template=function(h){if(!arguments.length)return e;e=h;return f};f.hosts=
function(h){if(!arguments.length)return a;a=h;return f};return f};q.dispatch=function(e){var f={};e.on=function(a,h){for(var i=f[a]||(f[a]=[]),c=0;c<i.length;c++)if(i[c].handler==h)return e;i.push({handler:h,on:true});return e};e.off=function(a,h){var i=f[a];if(i)for(var c=0;c<i.length;c++){var d=i[c];if(d.handler==h){d.on=false;i.splice(c,1);break}}return e};return function(a){var h=f[a.type];if(h){h=h.slice();for(var i=0;i<h.length;i++){var c=h[i];c.on&&c.handler.call(e,a)}}}};q.queue=function(){function e(){if(!(i>=
c||!h.length)){i++;h.pop()()}}function f(d){for(var l=0;l<h.length;l++)if(h[l]==d){h.splice(l,1);return true}return false}function a(d,l,o){function t(){m=new XMLHttpRequest;o&&m.overrideMimeType(o);m.open("GET",d,true);m.onreadystatechange=function(){if(m.readyState==4){i--;m.status<300&&l(m);e()}};m.send(null)}var m;h.push(t);e();return{abort:function(j){if(f(t))return true;if(j&&m){m.abort();return true}return false}}}var h=[],i=0,c=6;return{text:function(d,l,o){return a(d,function(t){t.responseText&&
l(t.responseText)},o)},xml:function(d,l){return a(d,function(o){o.responseXML&&l(o.responseXML)},"application/xml")},json:function(d,l){return a(d,function(o){o.responseText&&l(JSON.parse(o.responseText))},"application/json")},image:function(d,l,o){function t(){m=document.createElement("img");m.onerror=function(){i--;e()};m.onload=function(){i--;o(m);e()};m.src=l;d.setAttributeNS(q.ns.xlink,"href",l)}var m;h.push(t);e();return{abort:function(j){if(f(t))return true;if(j&&m){m.src="about:";return true}return false}}}}}();
q.map=function(){function e(){if(s)if(t<s[0])t=s[0];else if(t>s[1])t=s[1];m=t-(t=Math.round(t));j=Math.pow(2,m)}function f(){if(u){var g=45/Math.pow(2,t+m-3),r=Math.max(Math.abs(C*d.x+x*d.y),Math.abs(A*d.x+E*d.y)),y=U(k-r*g/l.y);r=U(n+r*g/l.y);o.lat=Math.max(y,Math.min(r,o.lat));y=Math.max(Math.abs(C*d.y+x*d.x),Math.abs(A*d.y+E*d.x));o.lon=Math.max(u[0].lon-y*g/l.x,Math.min(u[1].lon+y*g/l.x,o.lon))}}var a={},h,i,c=Y,d=Y,l={x:256,y:256},o={lat:37.76487,lon:-122.41948},t=12,m=0,j=1,s=[1,18],z=0,x=1,
C=0,E=1,A=0,k=-180,n=180,u=[{lat:U(k),lon:-Infinity},{lat:U(n),lon:Infinity}];a.locationCoordinate=function(g){g=q.map.locationCoordinate(g);var r=Math.pow(2,t);g.column*=r;g.row*=r;g.zoom+=t;return g};a.coordinateLocation=q.map.coordinateLocation;a.coordinatePoint=function(g,r){var y=Math.pow(2,t-r.zoom),F=Math.pow(2,t-g.zoom),w=(r.column*y-g.column*F)*l.x*j;y=(r.row*y-g.row*F)*l.y*j;return{x:d.x+x*w-C*y,y:d.y+C*w+x*y}};a.pointCoordinate=function(g,r){var y=Math.pow(2,t-g.zoom),F=(r.x-d.x)/j,w=(r.y-
d.y)/j;return{column:g.column*y+(E*F-A*w)/l.x,row:g.row*y+(A*F+E*w)/l.y,zoom:t}};a.locationPoint=function(g){var r=Math.pow(2,t+m-3)/45,y=(g.lon-o.lon)*r*l.x;g=(V(o.lat)-V(g.lat))*r*l.y;return{x:d.x+x*y-C*g,y:d.y+C*y+x*g}};a.pointLocation=function(g){var r=45/Math.pow(2,t+m-3),y=(g.x-d.x)*r;g=(g.y-d.y)*r;return{lon:o.lon+(E*y-A*g)/l.x,lat:U(V(o.lat)-(A*y+E*g)/l.y)}};var B=q.svg("rect");B.setAttribute("visibility","hidden");B.setAttribute("pointer-events","all");a.container=function(g){if(!arguments.length)return h;
h=g;h.setAttribute("class","map");h.appendChild(B);return a.resize()};a.focusableParent=function(){for(var g=h;g;g=g.parentNode)if(g.tabIndex>=0)return g;return window};a.mouse=function(g){var r=(h.ownerSVGElement||h).createSVGPoint();if($<0&&(window.scrollX||window.scrollY)){var y=document.body.appendChild(q.svg("svg"));y.style.position="absolute";y.style.top=y.style.left="0px";var F=y.getScreenCTM();$=!(F.f||F.e);document.body.removeChild(y)}if($){r.x=g.pageX;r.y=g.pageY}else{r.x=g.clientX;r.y=
g.clientY}return r.matrixTransform(h.getScreenCTM().inverse())};a.size=function(g){if(!arguments.length)return c;i=g;return a.resize()};a.resize=function(){if(i){c=i;Q.remove(a)}else{var g=h.ownerSVGElement||h;if(g.offsetWidth==null){B.setAttribute("width","100%");B.setAttribute("height","100%");g=B}b=g.getBoundingClientRect();c={x:b.width,y:b.height};Q.add(a)}B.setAttribute("width",c.x);B.setAttribute("height",c.y);d={x:c.x/2,y:c.y/2};f();a.dispatch({type:"resize"});return a};a.tileSize=function(g){if(!arguments.length)return l;
l=g;a.dispatch({type:"move"});return a};a.center=function(g){if(!arguments.length)return o;o=g;f();a.dispatch({type:"move"});return a};a.panBy=function(g){var r=45/Math.pow(2,t+m-3),y=g.x*r;g=g.y*r;return a.center({lon:o.lon+(A*g-E*y)/l.x,lat:U(V(o.lat)+(A*y+E*g)/l.y)})};a.centerRange=function(g){if(!arguments.length)return u;if(u=g){k=u[0].lat>-90?V(u[0].lat):-Infinity;n=u[0].lat<90?V(u[1].lat):Infinity}else{k=-Infinity;n=Infinity}f();a.dispatch({type:"move"});return a};a.zoom=function(g){if(!arguments.length)return t+
m;t=g;e();return a.center(o)};a.zoomBy=function(g,r,y){if(arguments.length<2)return a.zoom(t+m+g);if(arguments.length<3)y=a.pointLocation(r);t=t+m+g;e();var F=a.locationPoint(y);return a.panBy({x:r.x-F.x,y:r.y-F.y})};a.zoomRange=function(g){if(!arguments.length)return s;s=g;return a.zoom(t+m)};a.extent=function(g){if(!arguments.length)return[a.pointLocation({x:0,y:c.y}),a.pointLocation({x:c.x,y:0})];var r=a.locationPoint(g[0]),y=a.locationPoint(g[1]),F=Math.max((y.x-r.x)/c.x,(r.y-y.y)/c.y);r=a.pointLocation({x:(r.x+
y.x)/2,y:(r.y+y.y)/2});t=t+m-Math.log(F)/Math.log(2);e();return a.center(r)};a.angle=function(g){if(!arguments.length)return z;z=g;x=Math.cos(z);C=Math.sin(z);E=Math.cos(-z);A=Math.sin(-z);f();a.dispatch({type:"move"});return a};a.add=function(g){g.map(a);return a};a.remove=function(g){g.map(null);return a};a.dispatch=q.dispatch(a);return a};Q.maps=[];Q.add=function(e){for(var f=0;f<Q.maps.length;f++)if(Q.maps[f]==e)return;Q.maps.push(e)};Q.remove=function(e){for(var f=0;f<Q.maps.length;f++)if(Q.maps[f]==
e){Q.maps.splice(f,1);return}};window.addEventListener("resize",Q,false);q.map.locationCoordinate=function(e){var f=1/360;return{column:(e.lon+180)*f,row:(180-V(e.lat))*f,zoom:0}};q.map.coordinateLocation=function(e){var f=45/Math.pow(2,e.zoom-3);return{lon:f*e.column-180,lat:U(180-f*e.row)}};var $=/WebKit/.test(navigator.userAgent)?-1:0;q.layer=function(e,f){function a(A){for(var k=C[0].nextSibling;x<A;x++){s.insertBefore(C[-4],k);s.insertBefore(C[2],k);s.insertBefore(C[1],k);for(var n=C[-4],u=-4;u<
2;)C[u]=C[++u];C[u]=n}}function h(A){for(var k=C[0].nextSibling;x>A;x--){s.insertBefore(C[-1],k);s.insertBefore(C[2],C[-4]);for(var n=C[2],u=2;u>-4;)C[u]=C[--u];C[u]=n}}function i(){function A(L){var H=L.zoom,R=H<0?1:1<<H,S=L.column%R,v=L.row;if(S<0)S+=R;return{locationPoint:function(D){D=q.map.locationCoordinate(D);var G=Math.pow(2,H-D.zoom);return{x:y.x*(G*D.column-S),y:y.y*(G*D.row-v)}}}}function k(L,H,R){var S=O.zoom,v=2-T,D=4+T;for(L=L;L<H;L++){var G=d.load({column:L,row:R,zoom:S},A);if(!G.ready&&
!(G.key in N)){G.proxyRefs={};for(var J,K,M,P=1;P<=v;P++){K=true;for(var W=0,ea=1<<P;W<=ea;W++)for(var aa=0;aa<=ea;aa++)if((M=d.peek(J={column:(L<<P)+aa,row:(R<<P)+W,zoom:S+P}))&&M.ready){N[M.key]=d.load(J);M.proxyCount++;G.proxyRefs[M.key]=M}else K=false;if(K)break}if(!K)for(P=1;P<=D;P++)if((M=d.peek(J={column:L>>P,row:R>>P,zoom:S-P}))&&M.ready){N[M.key]=d.load(J);M.proxyCount++;G.proxyRefs[M.key]=M;break}}N[G.key]=G}}var n=c.map(),u=n.zoom(),B=u-(u=Math.round(u)),g=n.size(),r=n.angle(),y=n.tileSize(),
F=n.locationCoordinate(n.center());if(x!=u){if(x<u)a(u);else if(x>u)h(u);else x=u;for(var w=-4;w<=2;w++){var X=C[w];X.setAttribute("class","zoom"+(w<0?"":"+")+w+" zoom"+(u+w));X.setAttribute("transform","scale("+Math.pow(2,-w)+")")}}s.setAttribute("transform","translate("+g.x/2+","+g.y/2+")"+(r?"rotate("+r/Math.PI*180+")":"")+(B?"scale("+Math.pow(2,B)+")":"")+(z?z.zoomFraction(B):""));var O=n.pointCoordinate(F,Y);w=n.pointCoordinate(F,{x:g.x,y:0});u=n.pointCoordinate(F,g);n=n.pointCoordinate(F,{x:0,
y:g.y});if(!B&&!r&&!z){F.column=(Math.round(y.x*F.column)+(g.x&1)/2)/y.x;F.row=(Math.round(y.y*F.row)+(g.y&1)/2)/y.y}if(z){O=z.unapply(O);w=z.unapply(w);u=z.unapply(u);n=z.unapply(n);F=z.unapply(F)}var T=t?t(O.zoom)-O.zoom:0;if(T){r=Math.pow(2,T);O.column*=r;O.row*=r;w.column*=r;w.row*=r;u.column*=r;u.row*=r;n.column*=r;n.row*=r;O.zoom=w.zoom=u.zoom=n.zoom+=T}B=d.locks();var N={};for(var I in B)B[I].proxyCount=0;if(o&&T>-5&&T<3){r=O.zoom<0?1:1<<O.zoom;if(l){da(O,w,u,0,r,k);da(u,n,O,0,r,k)}else{g=
Math.floor((O.column+u.column)/2);r=Math.max(0,Math.min(r-1,Math.floor((w.row+n.row)/2)));w=Math.min(4,O.zoom);g=g>>w<<w;r=r>>w<<w;k(g,g+1,r)}}for(I in N){w=N[I];r=Math.pow(2,w.level=w.zoom-F.zoom);g=y.x*(w.column-F.column*r);r=y.y*(w.row-F.row*r);w.element.setAttribute("transform","translate("+g+","+r+")")}for(I in B)if(!(I in N)){w=d.unload(I);w.element.parentNode.removeChild(w.element);delete w.proxyRefs}for(I in N){w=N[I];if(w.element.parentNode!=C[w.level]){C[w.level].appendChild(w.element);
c.show&&c.show(w)}}d.flush()}var c={},d=c.cache=q.cache(e,f).size(512),l=true,o=true,t,m,j,s=q.svg("g"),z,x,C={};s.setAttribute("class","layer");for(var E=-4;E<=-1;E++)C[E]=s.appendChild(q.svg("g"));for(E=2;E>=1;E--)C[E]=s.appendChild(q.svg("g"));C[0]=s.appendChild(q.svg("g"));c.map=function(A){if(!arguments.length)return j;if(j){if(j==A){s.parentNode.appendChild(s);return c}j.off("move",i).off("resize",i);s.parentNode.removeChild(s)}if(j=A){j.container().appendChild(s);c.init&&c.init(s);j.on("move",
i).on("resize",i);i()}return c};c.container=function(){return s};c.id=function(A){if(!arguments.length)return m;m=A;s.setAttribute("id",A);return c};c.visible=function(A){if(!arguments.length)return o;(o=A)?s.removeAttribute("visibility"):s.setAttribute("visibility","hidden");j&&i();return c};c.transform=function(A){if(!arguments.length)return z;z=A;j&&i();return c};c.zoom=function(A){if(!arguments.length)return t;t=typeof A=="function"||A==null?A:function(){return A};j&&i();return c};c.tile=function(A){if(!arguments.length)return l;
l=A;j&&i();return c};c.reload=function(){d.clear();j&&i();return c};c.dispatch=q.dispatch(c);c.on("load",function(A){if(A.tile.proxyRefs){for(var k in A.tile.proxyRefs){var n=A.tile.proxyRefs[k];--n.proxyCount<=0&&d.unload(k)&&n.element.parentNode.removeChild(n.element)}delete A.tile.proxyRefs}});return c};q.image=function(){var e=q.layer(function(a){var h=a.element=q.svg("image"),i=e.map().tileSize();h.setAttribute("preserveAspectRatio","none");h.setAttribute("width",i.x);h.setAttribute("height",
i.y);h.setAttribute("opacity",0);if(typeof f=="function")a.request=q.queue.image(h,f(a),function(c){delete a.request;a.ready=true;a.img=c;h.removeAttribute("opacity");e.dispatch({type:"load",tile:a})});else{a.ready=true;h.setAttributeNS(q.ns.xlink,"href",f);e.dispatch({type:"load",tile:a})}},function(a){a.request&&a.request.abort(true)}),f="about:blank";e.url=function(a){if(!arguments.length)return f;f=typeof a=="string"&&/{.}/.test(a)?q.url(a):a;return e.reload()};return e};q.geoJson=function(e){function f(k,
n){return k&&k.type in C&&C[k.type](k,n)}function a(k,n){var u=n({lat:k[1],lon:k[0]}),B=q.svg("circle");B.setAttribute("r",4.5);B.setAttribute("cx",u.x);B.setAttribute("cy",u.y);return B}function h(k,n,u,B){B.push("M");for(var g=0;g<k.length-n;g++){p=u({lat:k[g][1],lon:k[g][0]});B.push(p.x);B.push(",");B.push(p.y);B.push("L")}B.pop()}function i(k,n,u,B){for(var g=0;g<k.length;g++)h(k[g],n,u,B);n&&B.push("Z")}function c(k,n,u,B){for(var g=[],r=0;r<n.length;r++)k(n[r],u,B,g);if(g.length){k=q.svg("path");
k.setAttribute("d",g.join(""));return k}}var d=q.layer(function(k,n){function u(g){var r=[];if(g.next)k.request=e(g.next.href,u);switch(g.type){case "FeatureCollection":for(var y=0;y<g.features.length;y++){var F=g.features[y],w=f(F.geometry,n.locationPoint);w&&r.push({element:B.appendChild(w),data:F})}break;case "Feature":(w=f(g.geometry,n.locationPoint))&&r.push({element:B.appendChild(w),data:g});break;default:(w=f(g,n.locationPoint))&&r.push({element:B.appendChild(w),data:{type:"Feature",geometry:g}});
break}k.ready=true;r.push.apply(k.features,r);d.dispatch({type:"load",tile:k,features:r})}var B=k.element=q.svg("g");k.features=[];n=n(k);if(x)u({type:"FeatureCollection",features:x});else k.request=e(typeof o=="function"?o(k):o,u)},function(k){k.request&&k.request.abort(true)}),l=d.container(),o="about:blank",t=true,m="org.polymaps."+q.id(),j="url(#"+m+")",s=l.insertBefore(q.svg("clipPath"),l.firstChild),z=s.appendChild(q.svg("rect")),x;l.setAttribute("fill-rule","evenodd");s.setAttribute("id",m);
if(!arguments.length)e=q.queue.json;var C={Point:function(k,n){return a(k.coordinates,n)},MultiPoint:function(k,n){for(var u=q.svg("g"),B=0;B<k.coordinates.length;B++)u.appendChild(a(k.coordinates[B],n));return u},LineString:function(k,n){return c(h,[k.coordinates],0,n)},MultiLineString:function(k,n){return c(h,k.coordinates,0,n)},Polygon:function(k,n){return c(i,[k.coordinates],1,n)},MultiPolygon:function(k,n){return c(i,k.coordinates||k.coords,1,n)},GeometryCollection:function(k,n){for(var u=q.svg("g"),
B=0;B<k.geometries.length;B++){var g=f(k.geometries[B],n);g&&u.appendChild(g)}return u}};d.url=function(k){if(!arguments.length)return o;o=typeof k=="string"&&/{.}/.test(k)?q.url(k):k;typeof o=="string"&&d.tile(false);return d.reload()};d.features=function(k){if(!arguments.length)return x;k&&d.tile(false);x=k;return d.reload()};d.clip=function(k){if(!arguments.length)return t;t&&l.removeChild(s);if(t=k)l.insertBefore(s,l.firstChild);var n=d.cache.locks();for(var u in n)t?n[u].element.setAttribute("clip-path",
j):n[u].element.removeAttribute("clip-path");return d};var E=d.tile;d.tile=function(k){arguments.length&&!k&&d.clip(k);return E.apply(d,arguments)};var A=d.map;d.map=function(k){if(k&&z){var n=k.tileSize();z.setAttribute("width",n.x);z.setAttribute("height",n.y)}return A.apply(d,arguments)};d.show=function(k){t?k.element.setAttribute("clip-path",j):k.element.removeAttribute("clip-path");d.dispatch({type:"show",tile:k,features:k.features});return d};d.reshow=function(){var k=d.cache.locks();for(var n in k)d.show(k[n]);
return d};return d};q.dblclick=function(){function e(c){var d=h.zoom();d=c.shiftKey?Math.ceil(d)-d-1:1-d+Math.floor(d);a==="mouse"?h.zoomBy(d,h.mouse(c)):h.zoomBy(d)}var f={},a="mouse",h,i;f.zoom=function(c){if(!arguments.length)return a;a=c;return f};f.map=function(c){if(!arguments.length)return h;if(h){i.removeEventListener("dblclick",e,false);i=null}if(h=c){i=h.container();i.addEventListener("dblclick",e,false)}return f};return f};q.drag=function(){function e(d){if(!d.shiftKey){c={x:d.clientX,
y:d.clientY};h.focusableParent().focus();d.preventDefault();document.body.style.setProperty("cursor","move",null)}}function f(d){if(c){h.panBy({x:d.clientX-c.x,y:d.clientY-c.y});c.x=d.clientX;c.y=d.clientY}}var a={},h,i,c;a.map=function(d){if(!arguments.length)return h;if(h){i.removeEventListener("mousedown",e,false);i=null}if(h=d){i=h.container();i.addEventListener("mousedown",e,false)}return a};window.addEventListener("mousemove",f,false);window.addEventListener("mouseup",function(d){if(c){f(d);
c=null;document.body.style.removeProperty("cursor")}},false);return a};q.wheel=function(){function e(){l=null}function f(m){var j=(m.wheelDelta/120||-m.detail)*0.1,s;if(ba<0){s=Date.now();var z=s-i;if(z>9&&Math.abs(m.wheelDelta)/z>=50)ba=1;i=s}if(ba==1)j*=0.03;if(!c&&j){s=Date.now();if(s-h>200){j=j>0?+1:-1;h=s}else j=0}if(j)switch(d){case "mouse":s=o.mouse(m);l||(l=o.pointLocation(s));o.off("move",e).zoomBy(j,s,l).on("move",e);break;case "location":o.zoomBy(j,o.locationPoint(l),l);break;default:o.zoomBy(j);
break}m.preventDefault();return false}var a={},h=0,i=0,c=true,d="mouse",l,o,t;a.smooth=function(m){if(!arguments.length)return c;c=m;return a};a.zoom=function(m,j){if(!arguments.length)return d;d=m;l=j;if(o)d=="mouse"?o.on("move",e):o.off("move",e);return a};a.map=function(m){if(!arguments.length)return o;if(o){t.removeEventListener("mousemove",e,false);t.removeEventListener("mousewheel",f,false);t.removeEventListener("DOMMouseScroll",f,false);t=null;o.off("move",e)}if(o=m){d=="mouse"&&o.on("move",
e);t=o.container();t.addEventListener("mousemove",e,false);t.addEventListener("mousewheel",f,false);t.addEventListener("DOMMouseScroll",f,false)}return a};return a};var ba=/WebKit\/533/.test(navigator.userAgent)?-1:0;q.arrow=function(){function e(z){if(!(z.ctrlKey||z.altKey||z.metaKey)){var x=Date.now(),C=0,E=0;switch(z.keyCode){case 37:if(!c.left){d=x;c.left=1;c.right||(C=m)}break;case 39:if(!c.right){d=x;c.right=1;c.left||(C=-m)}break;case 38:if(!c.up){d=x;c.up=1;c.down||(E=m)}break;case 40:if(!c.down){d=
x;c.down=1;c.up||(E=-m)}break;default:return}if(C||E)j.panBy({x:C,y:E});if(!l&&c.left|c.right|c.up|c.down)l=setInterval(h,t);z.preventDefault()}}function f(z){d=Date.now();switch(z.keyCode){case 37:c.left=0;break;case 39:c.right=0;break;case 38:c.up=0;break;case 40:c.down=0;break;default:return}if(l&&!(c.left|c.right|c.up|c.down))l=clearInterval(l);z.preventDefault()}function a(z){switch(z.charCode){case 45:case 95:j.zoom(Math.ceil(j.zoom())-1);break;case 43:case 61:j.zoom(Math.floor(j.zoom())+1);
break;default:return}z.preventDefault()}function h(){if(j)if(!(Date.now()<d+o)){var z=(c.left-c.right)*m,x=(c.up-c.down)*m;if(z||x)j.panBy({x:z,y:x})}}var i={},c={left:0,right:0,up:0,down:0},d=0,l,o=250,t=50,m=16,j,s;i.map=function(z){if(!arguments.length)return j;if(j){s.removeEventListener("keypress",a,false);s.removeEventListener("keydown",e,false);s.removeEventListener("keyup",f,false);s=null}if(j=z){s=j.focusableParent();s.addEventListener("keypress",a,false);s.addEventListener("keydown",e,false);
s.addEventListener("keyup",f,false)}return i};i.speed=function(z){if(!arguments.length)return m;m=z;return i};return i};q.hash=function(){function e(){var d=c.center(),l=c.zoom(),o=Math.max(0,Math.ceil(Math.log(l)/Math.LN2));d="#"+l.toFixed(2)+"/"+d.lat.toFixed(o)+"/"+d.lon.toFixed(o);if(h!==d)location.replace(h=d)}function f(){if(location.hash!==h){var d=(h=location.hash).substring(1).split("/").map(Number);if(d.length<3||d.some(isNaN))e();else{var l=c.size();c.zoomBy(d[0]-c.zoom(),{x:l.x/2,y:l.y/
2},{lat:Math.min(i,Math.max(-i,d[1])),lon:d[2]})}}}var a={},h,i=89.99999999,c;a.map=function(d){if(!arguments.length)return c;if(c){c.off("move",e);window.removeEventListener("hashchange",f,false)}if(c=d){c.on("move",e);window.addEventListener("hashchange",f,false);location.hash?f():e()}return a};return a};q.interact=function(){var e={},f=q.drag(),a=q.wheel(),h=q.dblclick(),i=q.arrow();e.map=function(c){f.map(c);a.map(c);h.map(c);i.map(c);return e};return e};q.compass=function(){function e(v){A.setAttribute("class",
"compass active");O||(O=setInterval(f,r));T&&H.panBy(T);B=Date.now();return m(v)}function f(){T&&Date.now()>B+g&&H.panBy(T)}function a(v){if(v.shiftKey){I={x0:H.mouse(v)};H.focusableParent().focus();return m(v)}}function h(v){if(I){I.x1=H.mouse(v);L.setAttribute("x",Math.min(I.x0.x,I.x1.x));L.setAttribute("y",Math.min(I.x0.y,I.x1.y));L.setAttribute("width",Math.abs(I.x0.x-I.x1.x));L.setAttribute("height",Math.abs(I.x0.y-I.x1.y));L.removeAttribute("display")}}function i(){A.setAttribute("class","compass");
if(I){if(I.x1){H.extent([H.pointLocation({x:Math.min(I.x0.x,I.x1.x),y:Math.max(I.x0.y,I.x1.y)}),H.pointLocation({x:Math.max(I.x0.x,I.x1.x),y:Math.min(I.x0.y,I.x1.y)})]);L.setAttribute("display","none")}I=null}if(O){clearInterval(O);O=0}}function c(v){return function(){v?this.setAttribute("class","active"):this.removeAttribute("class");T=v}}function d(v){return function(D){A.setAttribute("class","compass active");var G=H.zoom();H.zoom(v<0?Math.ceil(G)-1:Math.floor(G)+1);return m(D)}}function l(v){return function(D){H.zoom(v);
return m(D)}}function o(){this.setAttribute("class","active")}function t(){this.removeAttribute("class")}function m(v){v.stopPropagation();v.preventDefault();return false}function j(v){var D=Math.SQRT1_2*n,G=n*0.7,J=n*0.2,K=q.svg("g"),M=K.appendChild(q.svg("path")),P=K.appendChild(q.svg("path"));M.setAttribute("class","direction");M.setAttribute("pointer-events","all");M.setAttribute("d","M0,0L"+D+","+D+"A"+n+","+n+" 0 0,1 "+-D+","+D+"Z");P.setAttribute("class","chevron");P.setAttribute("d","M"+J+
","+(G-J)+"L0,"+G+" "+-J+","+(G-J));P.setAttribute("pointer-events","none");K.addEventListener("mousedown",e,false);K.addEventListener("mouseover",c(v),false);K.addEventListener("mouseout",c(null),false);K.addEventListener("dblclick",m,false);return K}function s(v){var D=n*0.4,G=D/2,J=q.svg("g"),K=J.appendChild(q.svg("path")),M=J.appendChild(q.svg("path")),P=J.appendChild(q.svg("path")),W=J.appendChild(q.svg("path"));K.setAttribute("class","back");K.setAttribute("d","M"+-D+",0V"+-D+"A"+D+","+D+" 0 1,1 "+
D+","+-D+"V0Z");M.setAttribute("class","direction");M.setAttribute("d",K.getAttribute("d"));P.setAttribute("class","chevron");P.setAttribute("d","M"+-G+","+-D+"H"+G+(v>0?"M0,"+(-D-G)+"V"+-G:""));W.setAttribute("class","fore");W.setAttribute("fill","none");W.setAttribute("d",K.getAttribute("d"));J.addEventListener("mousedown",d(v),false);J.addEventListener("mouseover",o,false);J.addEventListener("mouseout",t,false);J.addEventListener("dblclick",m,false);return J}function z(v){var D=n*0.2,G=n*0.4,J=
q.svg("g"),K=J.appendChild(q.svg("rect")),M=J.appendChild(q.svg("path"));K.setAttribute("pointer-events","all");K.setAttribute("fill","none");K.setAttribute("x",-G);K.setAttribute("y",-0.75*G);K.setAttribute("width",2*G);K.setAttribute("height",1.5*G);M.setAttribute("class","chevron");M.setAttribute("d","M"+-D+",0H"+D);J.addEventListener("mousedown",l(v),false);J.addEventListener("dblclick",m,false);return J}function x(){var v=n+6,D=v,G=H.size();switch(y){case "top-left":break;case "top-right":v=
G.x-v;break;case "bottom-left":D=G.y-D;break;case "bottom-right":v=G.x-v;D=G.y-D;break}v="translate("+v+","+D+")";N&&N.setAttribute("transform",v);w&&w.setAttribute("transform",v);for(var J in k)J==H.zoom()?k[J].setAttribute("class","active"):k[J].removeAttribute("class")}function C(){for(;A.lastChild;)A.removeChild(A.lastChild);A.appendChild(L);if(X!="none"){N=A.appendChild(q.svg("g"));N.setAttribute("class","pan");var v=N.appendChild(q.svg("circle"));v.setAttribute("class","back");v.setAttribute("r",
n);N.appendChild(j({x:0,y:-u})).setAttribute("transform","rotate(0)");N.appendChild(j({x:u,y:0})).setAttribute("transform","rotate(90)");N.appendChild(j({x:0,y:u})).setAttribute("transform","rotate(180)");N.appendChild(j({x:-u,y:0})).setAttribute("transform","rotate(270)");v=N.appendChild(q.svg("circle"));v.setAttribute("fill","none");v.setAttribute("class","fore");v.setAttribute("r",n)}else N=null;if(F!="none"){w=A.appendChild(q.svg("g"));w.setAttribute("class","zoom");v=-0.5;if(F=="big"){k={};var D=
H.zoomRange()[0];for(v=0;D<=H.zoomRange()[1];D++,v++)(k[D]=w.appendChild(z(D))).setAttribute("transform","translate(0,"+-(v+0.75)*n*0.4+")")}D=X=="none"?0.4:2;w.setAttribute("transform","translate(0,"+n*(/^top-/.test(y)?D+(v+0.5)*0.4:-D)+")");w.appendChild(s(+1)).setAttribute("transform","translate(0,"+-(v+0.5)*n*0.4+")");w.appendChild(s(-1)).setAttribute("transform","scale(-1)")}else w=null;x()}var E={},A=q.svg("g"),k={},n=30,u=16,B=0,g=250,r=50,y="top-left",F="small",w,X="small",O,T,N,I,L=q.svg("rect"),
H,R,S;A.setAttribute("class","compass");L.setAttribute("class","back fore");L.setAttribute("pointer-events","none");L.setAttribute("display","none");E.radius=function(v){if(!arguments.length)return n;n=v;H&&C();return E};E.speed=function(v){if(!arguments.length)return n;u=v;return E};E.position=function(v){if(!arguments.length)return y;y=v;H&&C();return E};E.pan=function(v){if(!arguments.length)return X;X=v;H&&C();return E};E.zoom=function(v){if(!arguments.length)return F;F=v;H&&C();return E};E.map=
function(v){if(!arguments.length)return H;if(H){R.removeEventListener("mousedown",a,false);R.removeChild(A);R=null;S.removeEventListener("mousemove",h,false);S.removeEventListener("mouseup",i,false);S=null;H.off("move",x).off("resize",x)}if(H=v){R=H.container();R.appendChild(A);R.addEventListener("mousedown",a,false);S=R.ownerDocument.defaultView;S.addEventListener("mousemove",h,false);S.addEventListener("mouseup",i,false);H.on("move",x).on("resize",x);C()}return E};return E};q.grid=function(){function e(){var i=
h.firstChild,c=a.size(),d=a.pointLocation(Y);a.pointLocation(c);var l=Math.pow(2,4-Math.round(a.zoom()));d.lat=Math.floor(d.lat/l)*l;d.lon=Math.ceil(d.lon/l)*l;for(var o;(o=a.locationPoint(d).x)<=c.x;d.lon+=l){i||(i=h.appendChild(q.svg("line")));i.setAttribute("x1",o);i.setAttribute("x2",o);i.setAttribute("y1",0);i.setAttribute("y2",c.y);i=i.nextSibling}for(;(o=a.locationPoint(d).y)<=c.y;d.lat-=l){i||(i=h.appendChild(q.svg("line")));i.setAttribute("y1",o);i.setAttribute("y2",o);i.setAttribute("x1",
0);i.setAttribute("x2",c.x);i=i.nextSibling}for(;i;){c=i.nextSibling;h.removeChild(i);i=c}}var f={},a,h=q.svg("g");h.setAttribute("class","grid");f.map=function(i){if(!arguments.length)return a;if(a){h.parentNode.removeChild(h);a.off("move",e).off("resize",e)}if(a=i){a.on("move",e).on("resize",e);a.container().appendChild(h);a.dispatch({type:"move"})}return f};return f}})(org.polymaps);
